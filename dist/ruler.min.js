/*
Copyright (c) 2019 Daybrush
name: @scena/ruler
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/ruler.git
version: 0.3.1
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Ruler=e()}(this,function(){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function i(e,n){return function(t){t&&(e[n]=t)}}var _=function(){function t(){this.keys=[],this.values=[]}var e=t.prototype;return e.get=function(t){return this.values[this.keys.indexOf(t)]},e.set=function(t,e){var n=this.keys,r=this.values,o=n.indexOf(t),i=-1===o?n.length:o;n[i]=t,r[i]=e},t}(),b=function(){function t(){this.object={}}var e=t.prototype;return e.get=function(t){return this.object[t]},e.set=function(t,e){this.object[t]=e},t}(),g="function"==typeof Map,s=function(){function t(){}var e=t.prototype;return e.connect=function(t,e){this.prev=t,this.next=e,t&&(t.next=this),e&&(e.prev=this)},e.disconnect=function(){var t=this.prev,e=this.next;t&&(t.next=e),e&&(e.prev=t)},e.getIndex=function(){for(var t=this,e=-1;t;)t=t.prev,++e;return e},t}();var O=function(){function t(t,e,n,r,o,i,s,u){this.prevList=t,this.list=e,this.added=n,this.removed=r,this.changed=o,this.maintained=i,this.changedBeforeAdded=s,this.fixed=u}var e=t.prototype;return Object.defineProperty(e,"ordered",{get:function(){return this.cacheOrdered||this.caculateOrdered(),this.cacheOrdered},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pureChanged",{get:function(){return this.cachePureChanged||this.caculateOrdered(),this.cachePureChanged},enumerable:!0,configurable:!0}),e.caculateOrdered=function(){var t=function(t,n){var u=[],a=[];return t.forEach(function(t){var e=t[0],n=t[1],r=new s;u[e]=r,a[n]=r}),u.forEach(function(t,e){t.connect(u[e-1])}),t.filter(function(t,e){return!n[e]}).map(function(t,e){var n=t[0],r=t[1];if(n===r)return[0,0];var o=u[n],i=a[r-1],s=o.getIndex();return o.disconnect(),i?o.connect(i,i.next):o.connect(void 0,u[0]),[s,o.getIndex()]})}(this.changedBeforeAdded,this.fixed),u=this.changed,a=[];this.cacheOrdered=t.filter(function(t,e){var n=t[0],r=t[1],o=u[e],i=o[0],s=o[1];if(n!==r)return a.push([i,s]),!0}),this.cachePureChanged=a},t}();function c(t,e,n){var r=g?Map:n?b:_,o=n||function(t){return t},i=[],s=[],u=[],a=t.map(o),c=e.map(o),f=new r,h=new r,p=[],l=[],d={},v=[],y=0,m=0;return a.forEach(function(t,e){f.set(t,e)}),c.forEach(function(t,e){h.set(t,e)}),a.forEach(function(t,e){var n=h.get(t);void 0===n?(++m,s.push(e)):d[n]=m}),c.forEach(function(t,e){var n=f.get(t);void 0===n?(i.push(e),++y):(u.push([n,e]),m=d[e]||0,p.push([n-m,e-y]),l.push(e===n),n!==e&&v.push([n,e]))}),s.reverse(),new O(t,e,i,s,v,u,p,l)}var e="string",u="undefined";function a(t){return typeof t===e}var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var p=function(){return(p=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function d(t,e){if(t===e)return!1;for(var n in t)if(!(n in e))return!0;for(var n in e)if(t[n]!==e[n])return!0;return!1}function v(o,i){var s=Object.keys(o),n=Object.keys(i),t=c(s,n,function(t){return t}),r={},u={},a={};return t.added.forEach(function(t){var e=n[t];r[e]=i[e]}),t.removed.forEach(function(t){var e=s[t];u[e]=o[e]}),t.maintained.forEach(function(t){var e=t[0],n=s[e],r=[o[n],i[n]];o[n]!==i[n]&&(a[n]=r)}),{added:r,removed:u,changed:a}}function y(t){t.forEach(function(t){t()})}function n(t){var e=0;return t.map(function(t){return null==t?"$compat"+ ++e:""+t})}function m(t,e,n,r){return a(t)?new C("text_"+t,e,n,r,null,{}):new("string"==typeof t.type?A:t.type.prototype.render?M:k)(t.type,e,n,r,t.ref,t.props)}function E(t){var e=[];return t.forEach(function(t){e=e.concat(function(t){return Array.isArray(t)}(t)?E(t):t)}),e}function P(t){var e=t.className,n=l(t,["className"]);return null!=e&&(n.class=e),delete n.style,delete n.children,n}function w(t,e){if(!e)return t;for(var n in e)typeof t[n]===u&&(t[n]=e[n]);return t}function x(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=e||{},i=o.key,s=o.ref,u=l(o,["key","ref"]);return{type:t,key:i,ref:s,props:p(p({},u),{children:E(n).filter(function(t){return null!=t})})}}var t=function(){function t(t,e,n,r,o,i){void 0===i&&(i={}),this.type=t,this.key=e,this.index=n,this.container=r,this.ref=o,this.props=i,this._providers=[]}var e=t.prototype;return e._should=function(t,e){return!0},e._update=function(t,e,n,r){if(this.base&&!a(e)&&!r&&!this._should(e.props,n))return!1;this.original=e,this._setState(n);var o=this.props;return a(e)||(this.props=e.props,this.ref=e.ref),this._render(t,this.base?o:{},n),!0},e._mounted=function(){var t=this.ref;t&&t(this.base)},e._setState=function(t){},e._updated=function(){var t=this.ref;t&&t(this.base)},e._destroy=function(){var t=this.ref;t&&t(null)},t}();function j(t){var e={},n={};for(var r in t)0===r.indexOf("on")?n[r.replace("on","").toLowerCase()]=t[r]:e[r]=t[r];return{attributes:e,events:n}}var C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}h(e,t);var n=e.prototype;return n._render=function(t){var e=this,n=!this.base;return n&&(this.base=document.createTextNode(this.type.replace("text_",""))),t.push(function(){n?e._mounted():e._updated()}),!0},n._unmount=function(){this.base.parentNode.removeChild(this.base)},e}(t),A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.events={},t}h(t,e);var n=t.prototype;return n.addEventListener=function(t,e){var n=this.events;n[t]=function(t){t.nativeEvent=t,e(t)},this.base.addEventListener(t,n[t])},n.removeEventListener=function(t){var e=this.events;this.base.removeEventListener(t,e[t]),delete e[t]},n._should=function(t){return d(this.props,t)},n._render=function(t,e){var n=this,r=!this.base;r&&(this.base=document.createElement(this.type)),D(this,this._providers,this.props.children,t,null);var o=this.base,i=j(e),s=i.attributes,u=i.events,a=j(this.props),c=a.attributes,f=a.events;return function(t,e,n){var r=v(t,e),o=r.added,i=r.removed,s=r.changed;for(var u in o)n.setAttribute(u,o[u]);for(var u in s)n.setAttribute(u,s[u][1]);for(var u in i)n.removeAttribute(u)}(P(s),P(c),o),function(t,e,n){var r=v(t,e),o=r.added,i=r.removed,s=r.changed;for(var u in i)n.removeEventListener(u);for(var u in o)n.addEventListener(u,o[u]);for(var u in s)n.removeEventListener(u),n.addEventListener(u,s[u][1]);for(var u in i)n.removeEventListener(u)}(u,f,this),function(t,e,n){var r=n.style,o=v(t,e),i=o.added,s=o.removed,u=o.changed;for(var a in i)r[a]=i[a];for(var a in u)r[a]=u[a][1];for(var a in s)r[a]=""}(e.style||{},this.props.style||{},o),t.push(function(){r?n._mounted():n._updated()}),!0},n._unmount=function(){var t=this.events,e=this.base;for(var n in t)e.removeEventListener(n,t[n]);this._providers.forEach(function(t){t._unmount()}),this.events={},e.parentNode.removeChild(e)},t}(t);function R(t){if(!t)return null;if(t instanceof Node)return t;var e=t._provider._providers;return e.length?R(e[0].base):null}var k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}h(e,t);var n=e.prototype;return n._render=function(t){var e=this.type(this.props);return D(this,this._providers,e?[e]:[],t),!0},n._unmount=function(){this._providers.forEach(function(t){t._unmount()})},e}(t),S=function(n){function t(t){var e=n.call(this,"container","container",0,null)||this;return e.base=t,e}h(t,n);var e=t.prototype;return e._render=function(){return!0},e._unmount=function(){},t}(t),M=function(s){function t(t,e,n,r,o,i){return void 0===i&&(i={}),s.call(this,t,e,n,r,o,w(i,t.defaultProps))||this}h(t,s);var e=t.prototype;return e._should=function(t,e){return this.base.shouldComponentUpdate(w(t,this.type.defaultProps),e||this.base.state)},e._render=function(t,e,n){var r=this;this.props=w(this.props,this.type.defaultProps);var o=!this.base;o?(this.base=new this.type(this.props),this.base._provider=this):this.base.props=this.props;var i=this.base,s=i.state,u=i.render();u&&u.props&&!u.props.children.length&&(u.props.children=this.props.children),D(this,this._providers,u?[u]:[],t,n,null),t.push(function(){o?(r._mounted(),i.componentDidMount()):(r._updated(),i.componentDidUpdate(e,s))})},e._setState=function(t){t&&(this.base.state=t)},e._unmount=function(){this._providers.forEach(function(t){t._unmount()}),this.base.componentWillUnmount()},t}(t),T=function(){function t(t){void 0===t&&(t={}),this.props=t,this.state={}}var e=t.prototype;return e.shouldComponentUpdate=function(t,e){return!0},e.render=function(){return null},e.setState=function(t,e,n){var r=[],o=this._provider;D(o.container,[o],[o.original],r,p(p({},this.state),t),n)&&(e&&r.push(e),y(r))},e.forceUpdate=function(t){this.setState(this.state,t,!0)},e.componentDidMount=function(){},e.componentDidUpdate=function(t,e){},e.componentWillUnmount=function(){},t}(),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.shouldComponentUpdate=function(t,e){return d(this.props,t)||d(this.state,e)},e}(T),z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}h(e,t);var n=e.prototype;return n.componentDidMount=function(){var t=this.props,e=t.element,n=t.container;this._portalProvider=new S(n),N(e,n,this._portalProvider)},n.componentDidUpdate=function(){var t=this.props;N(t.element,t.container,this._portalProvider)},n.componentWillUnmount=function(){N(null,this.props.container,this._portalProvider),this._portalProvider=null},e}(L);function U(o,s,i){var u=i.map(function(t){return a(t)?null:t.key}),t=c(n(s.map(function(t){return t.key})),n(u),function(t){return t});t.removed.forEach(function(t){s.splice(t,1)[0]._unmount()}),t.ordered.forEach(function(t){var e=t[0],n=t[1],r=s.splice(e,1)[0];s.splice(n,0,r);var o=R(r.base),i=R(s[n+1]&&s[n+1].base);o&&o.parentNode.insertBefore(o,i)}),t.added.forEach(function(t){s.splice(t,0,m(i[t],u[t],t,o))});var e=t.maintained.filter(function(t){t[0];var e=t[1],n=i[e],r=s[e];return(a(n)?"text_"+n:n.type)!==r.type?(r._unmount(),s.splice(e,1,m(n,u[e],e,o)),!0):(r.index=e,!1)});return function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],s=0,u=i.length;s<u;s++,o++)r[o]=i[s];return r}(t.added,e.map(function(t){t[0];return t[1]}))}function D(o,i,n,r,s,u){var t=U(o,i,n),e=i.filter(function(t,e){return t._update(r,n[e],s,u)}),a=function t(e){if(!e)return null;var n=e.base;return n instanceof Node?n:t(e.container)}(o);return a&&t.reverse().forEach(function(t){var e=i[t],n=R(e.base);if(n&&a!==n&&!n.parentNode){var r=function(t,e){for(var n=t._providers,r=n.length,o=e.index+1;o<r;++o){var i=R(n[o].base);if(i)return i}return null}(o,e);a.insertBefore(n,r)}}),0<e.length}function N(t,e,n){void 0===n&&(n=e.__REACT_COMPAT__);var r=!!n;return function(t,e,n){var r=[];D(t,t._providers,e,r,n),y(r)}(n=n||new S(e),t?[t]:[]),r||(e.__REACT_COMPAT__=n),n}function I(t,e,n){var r=e.__REACT_COMPAT__;t&&!r&&(e.innerHTML=""),N(t,e,r),n&&n()}var B=["type","width","height","unit","zoom","style","backgroundColor","lineColor","textColor","direction"],W=function(t,e){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={scrollPos:0},t.width=0,t.height=0,t}!function(t,e){function n(){this.constructor=t}W(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,e);var n=t.prototype;return n.render=function(){return x("canvas",{ref:i(this,"canvasElement"),style:this.props.style})},n.componentDidMount=function(){var t=this.canvasElement.getContext("2d");this.canvasContext=t,this.resize()},n.componentDidUpdate=function(){this.resize()},n.scroll=function(t){this.draw(t)},n.resize=function(){var t=this.canvasElement,e=this.props,n=e.width,r=e.height;this.width=n||t.offsetWidth,this.height=r||t.offsetHeight,t.width=2*this.width,t.height=2*this.height,this.draw()},n.draw=function(t){void 0===t&&(t=this.state.scrollPos);var e=this.props,n=e.unit,r=e.zoom,o=e.type,i=e.backgroundColor,s=e.lineColor,u=e.textColor,a=e.direction,c=this.width,f=this.height;this.state.scrollPos=t;var h=this.canvasContext,p="horizontal"===o,l="start"===a;h.rect(0,0,2*c,2*f),h.fillStyle=i,h.fill(),h.save(),h.scale(2,2),h.strokeStyle=s,h.lineWidth=1,h.font="10px sans-serif",h.fillStyle=u,l&&(h.textBaseline="top"),h.translate(.5,0),h.beginPath();for(var d=p?c:f,v=r*n,y=Math.floor(t*r/v),m=Math.ceil((t*r+d)/v)-y,_=0;_<m;++_){var b=((_+y)*n-t)*r;if(-v<=b&&b<d){var g=p?[3+b,l?17:f-17]:[l?17:c-17,b-4],O=g[0],E=g[1];p?h.fillText(""+(_+y)*n,O,E):(h.save(),h.translate(O,E),h.rotate(-Math.PI/2),h.fillText(""+(_+y)*n,0,0),h.restore())}for(var P=0;P<10;++P){var w=b+P/10*v;if(!(w<0||d<=w)){var x=0===P?p?f:c:P%2==0?10:7,j=p?[w,l?0:f-x]:[l?0:c-x,w],C=j[0],A=j[1],R=p?[C,A+x]:[C+x,A],k=R[0],S=R[1];h.moveTo(C,A),h.lineTo(k,S)}}}h.stroke(),h.restore()},t.defaultProps={type:"horizontal",zoom:1,width:0,height:0,unit:50,direction:"end",style:{width:"100%",height:"100%"},backgroundColor:"#333333",textColor:"#ffffff",lineColor:"#777777"},t}(L),$=function(n){function t(t){var e=n.call(this,t)||this;return e.state={},e.state=e.props,e}return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(t,n),t.prototype.render=function(){var t=this.state,e=t.parentElement,n=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(t,["parentElement"]);return function(t,e){return x(z,{element:t,container:e})}(x(H,o({ref:i(this,"ruler")},n)),e)},t}(T),q=function(){function t(t,e){void 0===e&&(e={}),this.tempElement=document.createElement("div"),I(x($,o({ref:i(this,"innerRuler")},e,{parentElement:t})),this.tempElement)}var e=t.prototype;return e.scroll=function(t){this.getRuler().scroll(t)},e.resize=function(){this.getRuler().resize()},e.destroy=function(){I(null,this.tempElement),this.tempElement=null,this.innerRuler=null},e.getRuler=function(){return this.innerRuler.ruler},t=function(t,e,n,r){var o,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var u=t.length-1;0<=u;u--)(o=t[u])&&(s=(i<3?o(s):3<i?o(e,n,s):o(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s}([function(n,r){return function(t){var e=t.prototype;n.forEach(function(t){r(e,t)})}}(B,function(t,n){Object.defineProperty(t,n,{get:function(){return this.getRuler().props[n]},set:function(t){var e;this.innerRuler.setState(((e={})[n]=t,e))},enumerable:!0,configurable:!0})})],t)}(),F={__proto__:null,default:q,PROPERTIES:B,METHODS:["scroll","resize"]};for(var G in F)q[G]=F[G];return q});
//# sourceMappingURL=ruler.min.js.map
